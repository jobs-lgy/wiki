(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{236:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"安装软件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装软件","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装软件")]),t._v(" "),s("h2",{attrs:{id:"安装docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装docker","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Docker")]),t._v(" "),s("p",[t._v("请参考 "),s("router-link",{attrs:{to:"/docker/"}},[t._v("Docker")])],1),t._v(" "),s("h2",{attrs:{id:"安装nexus"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装nexus","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Nexus")]),t._v(" "),s("h3",{attrs:{id:"docker安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装","aria-hidden":"true"}},[t._v("#")]),t._v(" docker安装")]),t._v(" "),s("p",[t._v("1、下载镜像")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull sonatype/nexus3  \n")])])]),s("p",[t._v("2、将容器内部/var/nexus-data挂载到主机/data/docker/nexus/data目录")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d -p 4070:8081 --name nexus -v /data/docker/nexus/data:/var/nexus-data sonatype/nexus3\n")])])]),s("p",[t._v("3、开放端口")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("firewall-cmd --zone=public --add-port=4070/tcp --permanent\n")])])]),s("p",[t._v("4、访问http://192.168.56.100:4070 ，Maven私服启动容器稍微比较慢，等待1分钟即可，默认登陆账号 admin，密码如果admin123不行，则查看 /data/docker/nexus/data/admin.password")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\n50fb70de8f66        sonatype/nexus3     "sh -c ${SONATYPE_DI…"   3 minutes ago       Up 3 minutes        0.0.0.0:4070->8081/tcp   nexus\n')])])]),s("p",[t._v("5、查看日志：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker logs -f nexus\n")])])]),s("h3",{attrs:{id:"docker-compose安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("p",[t._v("docker-compose.yml")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nexus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sonatype/nexus3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nexus\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4070"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/nexus/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/nexus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data\n")])])]),s("p",[t._v("出现异常：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("java.io.FileNotFoundException: ../sonatype-work/nexus3/tmp/i4j_ZTDnGON8hezynsMX2ZCYAVDtQog=.lock (No such file or directory)\n")])])]),s("p",[t._v("目录权限问题，修改为757后正常启动：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("chmod 757 /data/docker/nexus/data/\n")])])]),s("p",[t._v("另外一种推荐做法是，使用容器挂载数据比较不容易出现文件权限的问题。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker volume create --name nexus-data\n")])])]),s("p",[t._v("然后修改docker-compose.yml：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nexus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sonatype/nexus3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nexus\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4070"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/nexus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[s("strong",[t._v("1、创建私服仓库")])]),t._v(" "),s("p",[t._v("创建仓库，点击Create repository，然后选择maven2(hosted)然后输入仓库名称 nexus-release。在version policy中选择这个仓库的类型，这里选择release，在Deployment policy中选择Allow redeploy（这个很重要）.")]),t._v(" "),s("p",[s("strong",[t._v("2、创建私服账号")])]),t._v(" "),s("p",[t._v("点击左侧菜单栏的Users菜单，然后点击Create local user，我这里创建了一个用户，账号密码都是：test")]),t._v(" "),s("p",[t._v("本地settings.xml")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus-releases"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin123"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus-snapshots"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("username")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("admin123"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("servers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("Snapshots 与 Releases 的区别")]),t._v(" "),s("ul",[s("li",[t._v("nexus-releases: 用于发布 Release 版本")]),t._v(" "),s("li",[t._v("nexus-snapshots: 用于发布 Snapshot 版本（快照版）")])]),t._v(" "),s("p",[t._v("Release 版本与 Snapshot 定义如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Release: 1.0.0/1.0.0-RELEASE\nSnapshot: 1.0.0-SNAPSHOT\n")])])]),s("ul",[s("li",[t._v("在项目 pom.xml 中设置的版本号添加 SNAPSHOT 标识的都会发布为 SNAPSHOT 版本，没有 SNAPSHOT 标识的都会发布为 RELEASE 版本。")]),t._v(" "),s("li",[t._v("SNAPSHOT 版本会自动加一个时间作为标识，如：1.0.0-SNAPSHOT 发布后为变成 1.0.0-SNAPSHOT-20180522.123456-1.jar")])]),t._v(" "),s("p",[s("strong",[t._v("3、创建一个Maven工程")])]),t._v(" "),s("p",[t._v("创建一个maven工程，并且打包到maven私服。")]),t._v(" "),s("p",[t._v("相关配置")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("distributionManagement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus-releases"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Nexus Release Repository"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("http://192.168.56.100:4070/repository/nexus-releases/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("snapshotRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus-snapshots"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Nexus Snapshot Repository"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("http://192.168.56.100:4070/repository/nexus-snapshots/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("snapshotRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  \n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("distributionManagement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" \n\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--发布代码Jar插件 --\x3e")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.maven.plugins"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("maven-deploy-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.7"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--发布源码插件 --\x3e")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.maven.plugins"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("maven-source-plugin"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2.2.1"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("package"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("phase")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("jar"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("goals")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("execution")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("executions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("注意事项：")]),t._v(" "),s("ul",[s("li",[t._v("ID 名称必须要与 settings.xml 中 Servers 配置的 ID 名称保持一致。")]),t._v(" "),s("li",[t._v("项目版本号中有 SNAPSHOT 标识的，会发布到 Nexus Snapshots Repository, 否则发布到 Nexus Release Repository，并根据 ID 去匹配授权账号。")])]),t._v(" "),s("p",[s("strong",[t._v("4、部署jar包：")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mvn deploy\n")])])]),s("p",[s("strong",[t._v("5、上传第三方 JAR 包")])]),t._v(" "),s("p",[t._v("Nexus 3.0 不支持页面上传，可使用 maven 命令：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如第三方JAR包：aliyun-sdk-oss-2.2.3.jar")]),t._v("\nmvn deploy:deploy-file \n  -DgroupId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("com.aliyun.oss \n  -DartifactId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("aliyun-sdk-oss \n  -Dversion"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("2.2.3 \n  -Dpackaging"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jar \n  -Dfile"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("~/aliyun-sdk-oss-2.2.3.jar \n  -Durl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://192.168.56.100:8081/repository/nexus-releases/ \n  -DrepositoryId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nexus-releases\n")])])]),s("p",[t._v("注意事项：")]),t._v(" "),s("ul",[s("li",[t._v("建议在上传第三方 JAR 包时，创建单独的第三方 JAR 包管理仓库，便于管理有维护。（maven-3rd）")]),t._v(" "),s("li",[t._v("-DrepositoryId=nexus-releases 对应的是 settings.xml 中 Servers 配置的 ID 名称。（授权）")])]),t._v(" "),s("p",[s("strong",[t._v("5、配置代理仓库")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repositories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus-releases"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Nexus Repository"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("http://192.168.56.100:4070/repository/nexus-releases/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("snapshots")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("snapshots")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("releases")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("releases")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repositories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("pluginRepositories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("pluginRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("nexus"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Nexus Plugin Repository"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("http://192.168.56.100:4070/repository/nexus-releases/"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("snapshots")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("snapshots")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("releases")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("releases")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("pluginRepository")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("pluginRepositories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"安装gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装GItlab")]),t._v(" "),s("p",[t._v("GitLab 是利用 Ruby on Rails 一个开源的版本管理系统，实现一个自托管的 Git 项目仓库，可通过 Web 界面进行访问公开的或者私人项目。它拥有与 Github 类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序 (Wall) 进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。")]),t._v(" "),s("h3",{attrs:{id:"yum安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yum安装","aria-hidden":"true"}},[t._v("#")]),t._v(" yum安装")]),t._v(" "),s("h4",{attrs:{id:"配置yum源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置yum源","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置yum源")]),t._v(" "),s("p",[t._v("/etc/yum.repos.d/gitlab-ce.repo")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[gitlab-ce]\nname=Gitlab CE Repository\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/\ngpgcheck=0\nenabled=1\n")])])]),s("h4",{attrs:{id:"安装gitlab社区版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab社区版","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装GitLab社区版")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yum install -y gitlab-ce\n")])])]),s("h4",{attrs:{id:"gitlab常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab常用命令","aria-hidden":"true"}},[t._v("#")]),t._v(" GitLab常用命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl start    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动所有 gitlab 组件；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl stop        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止所有 gitlab 组件；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl restart        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启所有 gitlab 组件；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl status        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看服务状态；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl reconfigure        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动服务；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/gitlab/gitlab.rb        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改默认的配置文件；")]),t._v("\ngitlab-rake gitlab:check SANITIZE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true --trace    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查gitlab；")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" gitlab-ctl "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看日志；")]),t._v("\n")])])]),s("h4",{attrs:{id:"修改配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改配置文件")]),t._v(" "),s("p",[t._v("/etc/gitlab/gitlab.rb")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("external_url 'http://192.168.56.100:4080'\ngitlab_rails['time_zone'] = 'Asia/Shanghai'\ngitlab_rails['gitlab_shell_ssh_port'] = 4022\nunicorn['listen'] = '192.168.56.100'\n")])])]),s("h4",{attrs:{id:"汉化（可选）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#汉化（可选）","aria-hidden":"true"}},[t._v("#")]),t._v(" 汉化（可选）")]),t._v(" "),s("p",[t._v("下载最新的汉化包")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://gitlab.com/xhang/gitlab.git\n")])])]),s("p",[t._v("查看该汉化补丁的版本")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cd gitlab\ncat VERSION\n")])])]),s("p",[t._v("查看gitlab版本")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("head -1 /opt/gitlab/version-manifest.txt\n")])])]),s("p",[t._v("比较汉化标签和原标签，导出 patch 用的 diff 文件到/root下")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git diff v12.0.3 v12.0.3-zh > ../12.0.3-zh.diff\n")])])]),s("p",[t._v("打补丁：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" patch -y \n\npatch -d /opt/gitlab/embedded/service/gitlab-rails -p1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" 12.0.3-zh.diff\n")])])]),s("h4",{attrs:{id:"配置gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置gitlab","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置gitlab")]),t._v(" "),s("p",[t._v("内存不够，我先加 swap空间")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" /mnt/swap/\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" if"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/zero of"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("swapfile bs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1M count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("9999 \n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkswap")]),t._v(" swapfile\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swapon")]),t._v(" swapfile\n")])])]),s("p",[t._v("添加开机自动挂")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vim /etc/fstab \n/mnt/swap/swapfile swap swap defaults 0 0\n")])])]),s("p",[t._v("查看：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("top -c\n")])])]),s("p",[t._v("设置让系统积极使用swap空间：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("echo 100 > /proc/sys/vm/swappiness\n")])])]),s("p",[t._v("sysctl -p 或者重启生效")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("sysctl -p\n")])])]),s("p",[t._v("配置gitlab：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gitlab-ctl reconfigure\n")])])]),s("h4",{attrs:{id:"启动gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动gitlab","aria-hidden":"true"}},[t._v("#")]),t._v(" 启动gitlab")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gitlab-ctl start\n")])])]),s("h4",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),s("p",[t._v("访问http://192.168.56.100:4080/，设置登陆密码为admin123，登陆用户为root。")]),t._v(" "),s("h4",{attrs:{id:"设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置","aria-hidden":"true"}},[t._v("#")]),t._v(" 设置")]),t._v(" "),s("p",[t._v("第一次使用时需要做一些初始化设置，点击“管理区域”--\x3e“设置”，账户与限制设置：关闭头像功能，由于 Gravatar 头像为网络头像，在网络情况不理想时可能导致访问时卡顿")]),t._v(" "),s("p",[t._v("由于是内部代码托管服务器，可以直接关闭注册功能，由管理员统一创建用户即可")]),t._v(" "),s("h3",{attrs:{id:"docker安装-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装-2","aria-hidden":"true"}},[t._v("#")]),t._v(" docker安装")]),t._v(" "),s("blockquote",[s("p",[t._v("说明：用root安装")])]),t._v(" "),s("p",[t._v("1、下载镜像文件")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker pull docker.io/gitlab/gitlab-ce-zh\n")])])]),s("p",[t._v("2、  创建目录")]),t._v(" "),s("p",[t._v("将GitLab 的配置 (etc) 、 日志 (log) 、数据 (data) 放到容器之外， 便于日后升级， 因此请先准备这三个目录。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mkdir -p /data/docker/gitlab/conf\nmkdir -p /data/docker/gitlab/logs\nmkdir -p /data/docker/gitlab/data\n")])])]),s("p",[t._v("3、运行容器")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d --network "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" -p 4022:22 -p 4443:443 -p 4080:80  \\\n\t-v /data/docker/gitlab/etc:/etc/gitlab \\\n\t-v /data/docker/gitlab/logs:/var/log/gitlab \\\n\t-v /data/docker/gitlab/data:/var/opt/gitlab \\\n\t-v /etc/localtime:/etc/localtime:ro \\\n\t--name gitlab docker.io/twang2218/gitlab-ce-zh\n")])])]),s("p",[t._v("4、修改配置文件")]),t._v(" "),s("p",[t._v("进入容器修改配置文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it gitlab vim /etc/gitlab/gitlab.rb\n")])])]),s("p",[t._v("修改以下配置：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("external_url 'http://192.168.56.100:4080'\n\ngitlab_rails['gitlab_ssh_host'] = '192.168.56.100'\ngitlab_rails['gitlab_shell_ssh_port'] = 4022\ngitlab_rails['time_zone'] = 'Asia/Shanghai'\n")])])]),s("p",[t._v("修改"),s("code",[t._v("/data/docker/gitlab/data/gitlab-rails/etc/gitlab.yml")]),t._v("，找到关键字"),s("code",[t._v("* ## Web server settings *")]),t._v(" ，将host的值改成映射的外部主机IP地址 "),s("code",[t._v("192.168.56.100")]),t._v("，这里会显示在gitlab克隆地址。")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Web server settings (note: host is the FQDN, do not include http://)")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.56.100\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4080")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("https")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n")])])]),s("p",[t._v("重启容器：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker restart gitlab\n")])])]),s("p",[t._v("查看日志：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker logs -f gitlab\n\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("firewall-cmd --zone=public --add-port=8380/tcp --permanent\n")])])]),s("p",[t._v("5、测试")]),t._v(" "),s("p",[t._v("访问 http://192.168.56.100:4080，修改默认密码为"),s("code",[t._v("admin123")]),t._v("，然后再以root用户登陆。")]),t._v(" "),s("p",[t._v("创建项目，然后再克隆代码进行测试。")]),t._v(" "),s("blockquote",[s("p",[t._v("问题：ssh端口映射失败，ssh协议暂时用不了。")])]),t._v(" "),s("h3",{attrs:{id:"docker-compose安装-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-2","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("p",[t._v("我们使用 Docker 来安装和运行 GitLab 中文版，由于新版本问题较多，这里我们使用目前相对稳定的 10.5 版本，"),s("code",[t._v("docker-compose.yml")]),t._v(" 配置如下：")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab/gitlab-ce'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" unless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stopped\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("privileged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab.javachen.com'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Asia/Shanghai'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITLAB_OMNIBUS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          external_url 'http://gitlab.javachen.com:4080'\n          gitlab_rails['time_zone'] = 'Asia/Shanghai'\n          gitlab_rails['gitlab_shell_ssh_port'] = 4022")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'4080:8080'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/gitlab/conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/gitlab\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/gitlab/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/opt/gitlab\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/gitlab/logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/gitlab\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab.javachen.com:192.168.56.100"')]),t._v("\n\n")])])]),s("p",[t._v("后台运行：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker-compose up -d\n")])])]),s("h2",{attrs:{id:"安装gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab-runner","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装GitLab Runner")]),t._v(" "),s("h3",{attrs:{id:"yum安装-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yum安装-2","aria-hidden":"true"}},[t._v("#")]),t._v(" yum安装")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash\n\nyum install gitlab-ci-multi-runner -y\n")])])]),s("p",[t._v("注册：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gitlab-ci-multi-runner register\n")])])]),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[t._v("gitlab-ci-multi-runner register：执行注册命令")]),t._v(" "),s("li",[t._v("Please enter the gitlab-ci coordinator URL：输入 ci 地址")]),t._v(" "),s("li",[t._v("Please enter the gitlab-ci token for this runner：输入 ci token")]),t._v(" "),s("li",[t._v("Please enter the gitlab-ci description for this runner：输入 runner 名称")]),t._v(" "),s("li",[t._v("Please enter the gitlab-ci tags for this runner：设置 tag")]),t._v(" "),s("li",[t._v("Whether to run untagged builds：这里选择 true ，代码上传后会能够直接执行")]),t._v(" "),s("li",[t._v("Whether to lock Runner to current project：直接回车，不用输入任何口令")]),t._v(" "),s("li",[t._v("Please enter the executor：选择 runner 类型，这里我们选择的是 shell")])]),t._v(" "),s("p",[t._v("CI 的地址和令牌，在"),s("strong",[t._v("创建的项目")]),t._v("的项目 --\x3e 设置 --\x3e CI/CD --\x3e Runner 设置：")]),t._v(" "),s("p",[t._v("为保证能够正常集成，我们还需要一些其它配置：")]),t._v(" "),s("ul",[s("li",[t._v("安装完 GitLab Runner 后系统会增加一个 gitlab-runner 账户，我们将它加进 root 组：")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gpasswd -a gitlab-runner root\n")])])]),s("ul",[s("li",[t._v("配置需要操作目录的权限，比如你的 runner 要在 gaming 目录下操作：")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("chmod 775 gaming\n\n")])])]),s("ul",[s("li",[t._v("由于我们的 shell 脚本中有执行 git pull 的命令，我们直接设置以 ssh 方式拉取代码：")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" gitlab-runner\nssh-keygen -t rsa -C "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"你在 GitLab 上的邮箱地址"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" .ssh\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" id_rsa.pub\n")])])]),s("ul",[s("li",[t._v("复制 id_rsa.pub 中的秘钥到 GitLab：")])]),t._v(" "),s("p",[t._v("删除注册信息：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('gitlab-ci-multi-runner unregister --name "名称"\n')])])]),s("p",[t._v("查看注册列表：")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("gitlab-ci-multi-runner list\n")])])]),s("h3",{attrs:{id:"docker安装-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装-3","aria-hidden":"true"}},[t._v("#")]),t._v(" docker安装")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d --name gitlab-runner --restart always \\\n   -v /var/run/docker.sock:/var/run/docker.sock \\\n   --network"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("gitlab_net \\\n   --add-host"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("gitlab.javachen.com:192.168.56.100 \\\n   gitlab/gitlab-runner\n")])])]),s("h3",{attrs:{id:"docker-compose安装-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-3","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("ul",[s("li",[t._v("创建工作目录 "),s("code",[t._v("/data/docker/runner")])]),t._v(" "),s("li",[t._v("创建构建目录 "),s("code",[t._v("/data/docker/runner/environment")])])]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("/usr/local/docker/runner")]),t._v(" 目录下创建 "),s("code",[t._v("docker-compose.yml")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runner")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab/gitlab-runner:latest'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab-runner'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data/gitlab-runner/conf:/etc/gitlab-runner'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/var/run/docker.sock:/var/run/docker.sock'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" gitlab_net\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("extra_hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab.javachen.com:192.168.56.100"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitlab_net")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("注册：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" -it gitlab-runner gitlab-runner register\n")])])]),s("h2",{attrs:{id:"安装gogs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gogs","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装gogs")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker run -d --name=gogs -p 3022:22 -p 3000:3000 -e TZ=Asia/Shanghai -v /data/docker/gogs:/data gogs/gogs\n")])])]),s("h2",{attrs:{id:"安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Jenkins")]),t._v(" "),s("h3",{attrs:{id:"什么是-jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是 Jenkins")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww2.sinaimg.cn/large/006tNc79gy1g5ax5v4oebj30b203kjrl.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("Jenkins 是一个开源软件项目，是基于 Java 开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。")]),t._v(" "),s("p",[t._v("官方网站：https://jenkins.io/")]),t._v(" "),s("h3",{attrs:{id:"docker-安装-jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" Docker 安装 Jenkins")]),t._v(" "),s("h4",{attrs:{id:"docker-compose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose")]),t._v(" "),s("p",[t._v("Jenkins 是一个简单易用的持续集成软件平台，我们依然采用 Docker 的方式部署，"),s("code",[t._v("docker-compose.yml")]),t._v(" 配置文件如下：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jenkins")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jenkinsci/jenkins\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jenkins\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4090"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基于 JNLP 的 Jenkins 代理通过 TCP 端口 50000 与 Jenkins master 进行通信")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4091"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/jenkins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/jenkins_home\n")])])]),s("p",[t._v("访问jenkins地址 http://192.168.56.100:4090 ，注意：第一次启动的时候正在加载jenkins大概会等待3-10分钟。")]),t._v(" "),s("p",[t._v("安装过程中会出现 Docker 数据卷 权限问题，用以下命令解决：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R 1000 /usr/local/docker/jenkins/data\n")])])]),s("p",[t._v("Jenkins 第一次启动时需要输入一个初始密码用以解锁安装流程，使用 "),s("code",[t._v("docker logs jenkins")]),t._v(" 即可方便的查看到初始密码：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Jenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n58b7075d4576491d860a902f250698d2\nThis may also be found at: /var/jenkins_home/secrets/initialAdminPassword\n")])])]),s("p",[t._v("或者进入容器查看：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" -it jenkins /bin/bash \n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/jenkins_home/secrets/initialAdminPassword\n")])])]),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5ax7f84bkj30yh0nqgmz.jpg",alt:"img"}})]),t._v(" "),s("h4",{attrs:{id:"使用自定义插件的方式安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义插件的方式安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用自定义插件的方式安装")]),t._v(" "),s("p",[t._v("插件是 Jenkins 的核心，其丰富的插件（截止到 "),s("code",[t._v("2018.10.29")]),t._v(" 共有 "),s("code",[t._v("77350")]),t._v(" 个插件）可以满足不同人群的不同需求")]),t._v(" "),s("p",[t._v("插件地址：https://plugins.jenkins.io/")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww4.sinaimg.cn/large/006tNc79gy1g5ax8any5qj30ye0nq40x.jpg",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("注意：")]),t._v(" 除了默认勾选的插件外，一定要勾选 "),s("code",[t._v("Publish over SSH")]),t._v(" 插件，这是我们实现持续交付的重点插件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww4.sinaimg.cn/large/006tNc79gy1g5ax8clqahj30yh0nrtbp.jpg",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("开始安装了，根据网络情况，安装时间可能会比较长，请耐心等待")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww4.sinaimg.cn/large/006tNc79gy1g5ax8edn00j30yg0nuabt.jpg",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("很多插件装不上怎么办？不要慌，记住这些插件的名字，咱们稍后可以手动安装")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5ax8f8pl4j30yh0npjti.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("安装成功之后，创建用户名和密码 admin/admin123")]),t._v(" "),s("h3",{attrs:{id:"配置-jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置 Jenkins")]),t._v(" "),s("h4",{attrs:{id:"配置-jdk-maven"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-jdk-maven","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置 JDK & Maven")]),t._v(" "),s("p",[t._v("上传 JDK 和 Maven 的 tar 包到服务器（容器数据卷目录）")]),t._v(" "),s("p",[s("strong",[t._v("打开Jenkins的 主页面 > 系统管理 > Global Tool Configuration")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("安装 JDK（"),s("code",[t._v("JAVA_HOME")]),t._v(" "),s("strong",[t._v("的路径是宿主机目录，切记！")]),t._v("）")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/var/jenkins_home/jdk1.8.0_152\n")])])]),s("p",[s("img",{attrs:{src:"http://ww1.sinaimg.cn/large/006tNc79gy1g5axa0tf6kj314b09owel.jpg",alt:"img"}})]),t._v(" "),s("ul",[s("li",[t._v("安装 Maven（"),s("code",[t._v("MAVEN_HOME")]),t._v(" "),s("strong",[t._v("的路径是宿主机目录，切记！")]),t._v("）")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/var/jenkins_home/apache-maven-3.5.3\n")])])]),s("p",[s("img",{attrs:{src:"http://ww1.sinaimg.cn/large/006tNc79gy1g5axa1arnej314q09b74f.jpg",alt:"img"}})]),t._v(" "),s("ul",[s("li",[t._v("设置Git的路径")])]),t._v(" "),s("h4",{attrs:{id:"配置本地化（显示中文）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置本地化（显示中文）","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置本地化（显示中文）")]),t._v(" "),s("ul",[s("li",[t._v("安装 "),s("code",[t._v("Locale")]),t._v(" 插件")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5axa1p3k0j315b07ht8u.jpg",alt:"img"}})]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Manage Jenkins")]),t._v(" -> "),s("code",[t._v("Configure System")]),t._v(" -> "),s("code",[t._v("Locale")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5axa2dkp3j314n03eq2u.jpg",alt:"img"}})]),t._v(" "),s("ul",[s("li",[t._v("本地化效果图")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww2.sinaimg.cn/large/006tNc79gy1g5axa3onmgj30cl0gogm5.jpg",alt:"img"}})]),t._v(" "),s("h4",{attrs:{id:"安装动态参数插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装动态参数插件","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装动态参数插件")]),t._v(" "),s("p",[t._v("该插件的主要目的是为了方便我们后面在做项目构建时可以按照版本进行构建（支持一键回滚哦）")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5axa36virj314x0fymxy.jpg",alt:"img"}})]),t._v(" "),s("h4",{attrs:{id:"jenkins配置构建远程服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jenkins配置构建远程服务器","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkins配置构建远程服务器")]),t._v(" "),s("ul",[s("li",[t._v("交互式进入 Jenkins 容器")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it jenkins /bin/bash\n")])])]),s("ul",[s("li",[t._v("生成 SSH KEY")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ssh-keygen -f jenkins\n")])])]),s("ul",[s("li",[t._v("查看公钥")])]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cat ~/.ssh/jenkins.pub\n")])])]),s("ul",[s("li",[t._v("复制公钥到 GitLab")])]),t._v(" "),s("p",[t._v("登录服务器192.168.56.100将Jenkins生成的公钥加入authorized_keys")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("vim  ~/.ssh/authorized_keys\n")])])]),s("ul",[s("li",[t._v("jenkins配置 Publish Over SSH")])]),t._v(" "),s("p",[s("strong",[t._v("进入Jenkins平台，点击 系统管理 -> 系统设置 -> 找到 Publish Over SSH 配置项")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 查看并拷贝jenkins的私钥\n\ncat ~/.ssh/jenkins\n")])])]),s("ul",[s("li",[s("code",[t._v("系统管理")]),t._v(" -> "),s("code",[t._v("系统设置")]),t._v(" -> "),s("code",[t._v("Publish over SSH")])])]),t._v(" "),s("p",[s("strong",[t._v("注：Jenkins SSH Key 这一栏默认会使用Jenkins管理员admin账户的密码，可以不填则设置为空密码")])]),t._v(" "),s("p",[t._v("在key一栏填入拷贝的jenkins的私钥。")]),t._v(" "),s("p",[t._v("SSH Server的hostname填 192.168.56.100，username填root")]),t._v(" "),s("p",[t._v("其中 "),s("code",[t._v("Remote Directory")]),t._v(" 是指 Jenkins 可以在目标服务器操作的目录，填/usr/local/jenkins")]),t._v(" "),s("ul",[s("li",[t._v("测试是否能够正常通信")])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww2.sinaimg.cn/large/006tNc79gy1g5axe5q7u1j30s60i70t7.jpg",alt:"img"}})]),t._v(" "),s("h3",{attrs:{id:"创建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建项目","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建项目")]),t._v(" "),s("p",[t._v("1、创建test项目")]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww1.sinaimg.cn/large/006tNc79gy1g5b086c4hpj30vg0lmq4r.jpg",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("其它配置项先默认即可")])]),t._v(" "),s("p",[t._v('2、进入jenkins平台打开 系统管理 -> 管理插件 -> 可选插件，在右上角输入框中输入"gogs"来筛选插件：')]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww2.sinaimg.cn/large/006tNc79gy1g5b0efwtxyj318k0as0tb.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("3、gogs中仓库配置")]),t._v(" "),s("p",[t._v("创建一个test仓库，点击仓库设置，"),s("strong",[t._v("点击 管理Web钩子 -> 添加Web钩子 -> 选择Gogs")]),t._v("，添加下面钩子：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://192.168.56.100:4090/gogs-webhook/?job=test\n")])])]),s("p",[t._v("4、点击 推送测试，如 成功 会看到下推送记录")]),t._v(" "),s("p",[t._v("5、项目Git项相关配置：")]),t._v(" "),s("p",[s("strong",[t._v("打开项目（test）配置页")]),t._v("，配置Git仓库")]),t._v(" "),s("p",[t._v("http://192.168.56.100:3000/june/test")]),t._v(" "),s("p",[t._v("6、建构触发器配置")]),t._v(" "),s("p",[t._v("7、构建项配置")]),t._v(" "),s("p",[s("strong",[t._v('最核心的一步，选择"Send files or execute commands over SSH"')])]),t._v(" "),s("p",[s("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79gy1g5b1nfwvu0j30wa0mqabb.jpg",alt:"img"}})]),t._v(" "),s("p",[t._v("8、推送自动构建测试")]),t._v(" "),s("p",[s("strong",[t._v("Gogs上关联的仓库（test）master分支下push一条修改记录后，会发现jenkins上自动完成本地push的远程构建")])]),t._v(" "),s("p",[t._v("参考文章：")]),t._v(" "),s("p",[t._v("https://www.jianshu.com/p/14e356cf8bb4")]),t._v(" "),s("h2",{attrs:{id:"安装mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装mysql","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装MySQL")]),t._v(" "),s("h3",{attrs:{id:"使用docker安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用docker安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用Docker安装")]),t._v(" "),s("p",[t._v("下载镜像：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull mysql\n")])])]),s("p",[t._v("运行容器：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d -p 3306:3306  \\\n  -v /data/docker/mysql/conf:/etc/mysql \\\n  -v /data/docker/mysql/logs:/var/log/mysql \\\n  -v /data/docker/mysql/data:/var/lib/mysql \\\n  -e MYSQL_ROOT_PASSWORD"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("123456 \\\n  --name mysql mysql\n")])])]),s("p",[t._v("命令参数：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("-p 3306:3306")]),t._v("：将容器的3306端口映射到主机的3306端口")]),t._v(" "),s("li",[s("code",[t._v("-v /data/docker/mysql/conf:/etc/mysql")]),t._v("：将主机当前目录下的 conf 挂载到容器的 /etc/mysql")]),t._v(" "),s("li",[s("code",[t._v("-v /data/docker/mysql/logs:/var/log/mysql")]),t._v("：将主机当前目录下的 logs 目录挂载到容器的 /var/log/mysql")]),t._v(" "),s("li",[s("code",[t._v("-v /data/docker/mysql/data:/var/lib/mysql")]),t._v("：将主机当前目录下的 data 目录挂载到容器的 /var/lib/mysql")]),t._v(" "),s("li",[s("code",[t._v("-e MYSQL_ROOT_PASSWORD=123456")]),t._v("：初始化root用户的密码")])]),t._v(" "),s("p",[t._v("查看容器启动情况：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker ps\n")])])]),s("p",[t._v("防火墙开启3306端口")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("firewall-cmd --add-port=3306/tcp\n\nfirewall-cmd --zone=public --add-port=3306/tcp --permanent\n")])])]),s("p",[t._v("/data/docker/mysql/conf下创建my.cnf")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[client]\ndefault-character-set=utf8mb4\n\n[mysqld]\ncharacter-set-client-handshake = FALSE\ncharacter-set-server = utf8mb4\ncollation-server = utf8mb4_unicode_ci\n\n\n[mysql]\ndefault-character-set=utf8mb4\n")])])]),s("p",[t._v("重新启动容器")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker restart mysql\n")])])]),s("p",[t._v("进入容器：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it mysql bash\n")])])]),s("p",[t._v("在宿主机上登陆mysql：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#登录mysql")]),t._v("\nmysql -h192.168.56.100 -p3306 -uroot -p123456\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#添加远程登录用户")]),t._v("\nCREATE USER "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("@"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),t._v(" IDENTIFIED WITH mysql_native_password BY "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'123456'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nGRANT ALL PRIVILEGES ON *.* TO "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("@"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看编码")]),t._v("\nshowvariables like "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%char%"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nflush privileges"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用docker-compose安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用docker-compose安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用docker-compose安装")]),t._v(" "),s("p",[t._v("docker-compose.yml配置文件如下：")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql \n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("authentication"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("plugin=mysql_native_password\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("character"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server=utf8mb4_general_ci\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("explicit_defaults_for_timestamp=true\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lower_case_table_names=1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 3306"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/mysql/conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/mysql\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/mysql/logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/log/mysql \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/mysql/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n")])])]),s("h2",{attrs:{id:"安装redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装redis","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Redis")]),t._v(" "),s("h3",{attrs:{id:"docker安装-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装-4","aria-hidden":"true"}},[t._v("#")]),t._v(" docker安装")]),t._v(" "),s("p",[t._v("1、下载镜像")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull  redis\n")])])]),s("p",[t._v("2、运行容器")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("docker run -d --name redis -p 6379:6379 \\\n  -v /data/docker/redis/data:/data \\\n  -v /data/docker/redis/conf/redis.conf:/etc/redis/redis.conf \\\n  --privileged"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true redis:latest --appendonly "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v(" --requirepass "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v(" \n")])])]),s("blockquote",[s("p",[t._v("注意：/etc/redis/redis.conf 是个目录")])]),t._v(" "),s("p",[t._v("创建目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mkdir /data/docker/redis/data\n\nmkdir /data/docker/redis/conf\n")])])]),s("p",[t._v("创建 /data/docker/redis/conf/redis.conf")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("bind 0.0.0.0\nprotected-mode no\nport 6379\ntcp-backlog 511\ntimeout 0\ntcp-keepalive 300\n")])])]),s("p",[t._v("3、查看容器")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker ps\n")])])]),s("p",[t._v("4、开发端口")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("firewall-cmd --zone"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("6379/tcp --permanent\n")])])]),s("p",[t._v("5、进入容器")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker exec -it redis redis-cli -h 192.168.56.100 -p 6379 -a '123456'\n")])])]),s("h3",{attrs:{id:"docker-compose安装-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-4","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server /etc/redis/redis.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/redis/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/redis/conf/redis.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/redis/redis.conf\n")])])]),s("h3",{attrs:{id:"集群安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 集群安装")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6380"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6381"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /data/docker/redis/conf/sentinel.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/redis/conf/sentinel1.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26380"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /usr/local/etc/redis/sentinel.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/redis/conf/sentinel2.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26381"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /usr/local/etc/redis/sentinel.conf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/redis/conf/sentinel3.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/sentinel.conf\n")])])]),s("p",[t._v("sentinel.conf")]),t._v(" "),s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("port 26379\ndir /tmp\n# 自定义集群名，其中 127.0.0.1 为 redis-master 的 ip，6379 为 redis-master 的端口，2 为最小投票数（因为有 3 台 Sentinel 所以可以设置成 2）\nsentinel monitor mymaster 127.0.0.1 6379 2\nsentinel down-after-milliseconds mymaster 30000\nsentinel parallel-syncs mymaster 1\nsentinel failover-timeout mymaster 180000\nsentinel deny-scripts-reconfig yes\n")])])]),s("h2",{attrs:{id:"安装rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装rabbitmq","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装RabbitMQ")]),t._v(" "),s("h3",{attrs:{id:"docker安装-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装-5","aria-hidden":"true"}},[t._v("#")]),t._v(" docker安装")]),t._v(" "),s("p",[t._v("获取rabbit镜像：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker pull rabbitmq:management\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("firewall-cmd --zone=public --add-port=5672/tcp --permanent\nfirewall-cmd --zone=public --add-port=15672/tcp --permanent\n")])])]),s("p",[t._v("创建并运行容器：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker run -d --name rabbitmq -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=123456 -p 15672:15672 -p 5672:5672 --restart=always rabbitmq:management\n")])])]),s("p",[t._v("容器运行正常，使用http://192.168.56.100:15672访问rabbit控制台，用户名和密码admin和123456。")]),t._v(" "),s("p",[t._v("cshop-sms使用：")]),t._v(" "),s("ul",[s("li",[t._v("在管理界面添加一个虚拟主机/chsop，添加一个交换机cshop.sms.exchange，添加一个队里cshop.sms.queue，然后交换机绑定虚拟主机和队列。")])]),t._v(" "),s("p",[t._v("cshop-email使用：")]),t._v(" "),s("h3",{attrs:{id:"docker-compose安装-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-5","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nexus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("management\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rabbitmq\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("RABBITMQ_DEFAULT_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cshop\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("RABBITMQ_DEFAULT_PASS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cshop\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 15672"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15672")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 5672"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5672")]),t._v("\n")])])]),s("h2",{attrs:{id:"安装nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装Nginx")]),t._v(" "),s("h3",{attrs:{id:"docker-compose安装-6"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-6","aria-hidden":"true"}},[t._v("#")]),t._v(" docker compose安装")]),t._v(" "),s("p",[t._v("创建目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mkdir -p /data/docker/nginx/wwwroot/html80\n\nmkdir -p /data/docker/nginx/wwwroot/html8080\n\nmkdir -p /data/docker/nginx/conf\n")])])]),s("p",[t._v("修改 "),s("code",[t._v("/data/docker/nginx/conf/nginx.conf")]),t._v(" 目录下的 nginx.conf")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4180"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4181"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/nginx/conf/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/nginx/nginx.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/nginx/wwwroot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/nginx/wwwroot\n")])])]),s("p",[t._v("nginx.conf")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("worker_processes  1;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    sendfile        on;\n    \n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  static.cshop.com;\n\t\t\t\t# 所有的请求都以 / 开始，所有的请求都可以匹配此 location\n        location / {\n            root   /usr/share/nginx/wwwroot/html80;\n            index  index.html index.htm;\n        }\n    }\n    server {\n        listen       8080;\n        server_name  admin.cshop.com;\n\n        location / {\n            root   /usr/share/nginx/wwwroot/html8080;\n            index  index.html index.htm;\n        }\n    }\n}\n")])])]),s("p",[t._v("配置hosts：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("192.168.56.100 admin.cshop.com\n\n192.168.56.100 static.cshop.com\n")])])]),s("h3",{attrs:{id:"docker-compose安装-7"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose安装-7","aria-hidden":"true"}},[t._v("#")]),t._v(" docker-compose安装")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 4001"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/nginx/conf/nginx.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/nginx/nginx.conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /data/docker/nginx/wwwroot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/share/nginx/wwwroot\n")])])]),s("h2",{attrs:{id:"安装elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装elasticsearch","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装ElasticSearch")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("version: '3.3'\nservices:\n  elasticsearch:\n    image: elasticsearch:6.4.3\n    container_name: elasticsearch\n    restart: always\n    ports:\n      - 9200:9200\n      - 9300:9300\n    environment:\n      cluster.name: elasticsearch\n    volumes:\n      - /data/docker/elasticsearch/data:/usr/share/elasticsearch/data\n      - /data/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins\n")])])]),s("p",[s("strong",[t._v("集成IK分词器")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.3/elasticsearch-analysis-ik-6.4.3.zip \n")])])]),s("p",[t._v("解压：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("unzip elasticsearch-analysis-ik-6.4.3 -d  analysis-ik\n")])])]),s("p",[t._v("拷贝到插件目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cp -r analysis-ik plugins\n")])])]),s("p",[s("strong",[t._v("集成拼音分词器")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("wget https://github.com/medcl/elasticsearch-analysis-pinyin/releases/download/v6.4.3/elasticsearch-analysis-pinyin-6.4.3.zip\n")])])]),s("p",[t._v("解压：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("unzip elasticsearch-analysis-pinyin-6.4.3 -d  analysis-pinyin\n")])])]),s("p",[t._v("拷贝到插件目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("cp -r analysis-pinyin plugins\n")])])])])},[],!1,null,null,null);a.default=e.exports}}]);