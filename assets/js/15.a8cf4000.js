(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{196:function(a,e,t){"use strict";t.r(e);var s=t(0),r=Object(s.a)({},function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"docker安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker安装","aria-hidden":"true"}},[a._v("#")]),a._v(" Docker安装")]),a._v(" "),t("h2",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装Docker")]),a._v(" "),t("h3",{attrs:{id:"yum安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yum安装","aria-hidden":"true"}},[a._v("#")]),a._v(" yum安装")]),a._v(" "),t("p",[a._v("在centos7虚拟机中，添加docker yum源：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n")])])]),t("p",[a._v("安装官方版本：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker -y\n")])])]),t("p",[a._v("设置开启启动：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("systemctl enable docker\n")])])]),t("p",[a._v("启动docker：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("systemctl start docker\n")])])]),t("p",[a._v("查看版本：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ docker version\nClient:\n Version:         1.13.1\n API version:     1.26\n Package version: docker-1.13.1-96.gitb2f74b2.el7.centos.x86_64\n Go version:      go1.10.3\n Git commit:      b2f74b2/1.13.1\n Built:           Wed May  1 14:55:20 2019\n OS/Arch:         linux/amd64\n\nServer:\n Version:         1.13.1\n API version:     1.26 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("minimum version 1.12"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n Package version: docker-1.13.1-96.gitb2f74b2.el7.centos.x86_64\n Go version:      go1.10.3\n Git commit:      b2f74b2/1.13.1\n Built:           Wed May  1 14:55:20 2019\n OS/Arch:         linux/amd64\n Experimental:    "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n")])])]),t("p",[a._v("查看容器相关信息：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# docker info\n")])])]),t("h3",{attrs:{id:"建立用户组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建立用户组","aria-hidden":"true"}},[a._v("#")]),a._v(" 建立用户组")]),a._v(" "),t("p",[a._v("默认情况下，"),t("code",[a._v("docker")]),a._v(" 命令会使用 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Unix_domain_socket",target:"_blank",rel:"noopener noreferrer"}},[a._v("Unix socket"),t("OutboundLink")],1),a._v(" 与 Docker 引擎通讯。而只有 "),t("code",[a._v("root")]),a._v(" 用户和 "),t("code",[a._v("docker")]),a._v("组的用户才可以访问 Docker 引擎的 Unix socket。出于安全考虑，一般 Linux 系统上不会直接使用 "),t("code",[a._v("root")]),a._v(" 用户。因此，更好地做法是将需要使用 "),t("code",[a._v("docker")]),a._v(" 的用户加入 "),t("code",[a._v("docker")]),a._v(" 用户组。")]),a._v(" "),t("p",[a._v("建立 "),t("code",[a._v("docker")]),a._v(" 组：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" docker\n")])])]),t("p",[a._v("将当前用户加入 "),t("code",[a._v("docker")]),a._v(" 组：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("usermod")]),a._v(" -aG docker "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$USER")]),a._v("\n")])])]),t("h2",{attrs:{id:"安装docker-registry"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-registry","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装Docker-Registry")]),a._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3.1'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("registry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" registry\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" registry\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 5000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5000")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /data/docker/registry/data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/registry\n")])])]),t("p",[a._v("测试，浏览器访问  http://192.168.56.100:5000/v2/")]),a._v(" "),t("p",[a._v("修改/etc/docker/daemon.json")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{\n  "registry-mirrors": [\n    "https://registry.docker-cn.com"\n  ],\n  "insecure-registries": [\n    "192.168.56.100:5000"\n  ]\n}\n')])])]),t("p",[a._v("之后重新启动服务。")]),a._v(" "),t("p",[a._v("测试镜像上传功能")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("## 拉取一个镜像\ndocker pull nginx\n\n## 查看全部镜像\ndocker images\n\n## 标记本地镜像并指向目标仓库（ip:port/image_name:tag，该格式为标记版本号）\ndocker tag nginx 192.168.56.100:5000/nginx\n\n## 提交镜像到仓库\ndocker push 192.168.56.100:5000/nginx\n")])])]),t("p",[a._v("查看全部镜像")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -XGET http://192.168.56.100:5000/v2/_catalog\n")])])]),t("p",[a._v("以 Nginx 为例，查看已提交的列表")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("curl -XGET http://192.168.56.100:5000/v2/nginx/tags/list\n")])])]),t("p",[a._v("测试拉取镜像")]),a._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("docker rmi nginx\ndocker rmi 192.168.56.100:5000/nginx\ndocker pull 192.168.56.100:5000/nginx\n")])])]),t("h2",{attrs:{id:"配置镜像加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置镜像加速","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置镜像加速")]),a._v(" "),t("p",[a._v("国内从 Docker Hub 拉取镜像有时会遇到困难，此时可以配置镜像加速器。Docker 官方和国内很多云服务商都提供了国内加速器服务，例如：")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/registry/recipes/mirror/#use-case-the-china-registry-mirror",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker 官方提供的中国 registry mirror"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://cr.console.aliyun.com/#/accelerator",target:"_blank",rel:"noopener noreferrer"}},[a._v("阿里云加速器"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://www.daocloud.io/mirror#accelerator-doc",target:"_blank",rel:"noopener noreferrer"}},[a._v("DaoCloud 加速器"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("centos系统上，配置镜像：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n  "registry-mirrors": ["http://hub-mirror.c.163.com"]\n}\'')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/docker/daemon.json\n")])])]),t("p",[a._v("主要是修改/etc/docker/daemon.json文件。")]),a._v(" "),t("p",[a._v("开启路由转发功能：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" 1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /proc/sys/net/ipv4/ip_forward\n")])])])])},[],!1,null,null,null);e.default=r.exports}}]);